<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback - Shree Sambhaji Raje HSG SOC</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Tiro+Devanagari+Marathi&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="assest/image/society.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="assest/style.css">

    <style>
        /* --- FEEDBACK SPECIFIC STYLES --- */
        .feedback-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .feedback-form-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border-top: 5px solid var(--primary);
            margin-bottom: 50px;
        }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 8px; color: var(--secondary); }
        .form-input {
            width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem;
            transition: 0.3s;
        }
        .form-input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(194, 65, 12, 0.1); }

        /* ADVANCED STAR RATING */
        .star-rating {
            display: flex;
            flex-direction: row-reverse; /* Magic trick for CSS hover */
            justify-content: flex-end;
            gap: 10px;
            font-size: 2rem;
        }
        .star-rating input { display: none; }
        .star-rating label {
            color: #cbd5e1; /* Gray by default */
            cursor: pointer;
            transition: 0.2s;
        }
        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input:checked ~ label {
            color: #fbbf24; /* Gold */
            transform: scale(1.1);
        }

        /* FEEDBACK LIST */
        .review-list { display: flex; flex-direction: column; gap: 20px; }
        .review-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e2e8f0;
            position: relative;
            animation: fadeIn 0.5s;
        }
        .review-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .reviewer-name { font-weight: bold; font-size: 1.1rem; color: var(--secondary); }
        .review-date { font-size: 0.85rem; color: #64748b; }
        .review-stars { color: #fbbf24; margin-bottom: 10px; }
        .review-text { color: #475569; line-height: 1.6; }

        /* DELETE BUTTON (Hidden by default logic) */
        .delete-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #fee2e2;
            color: #ef4444;
            border: none;
            width: 30px; height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center; justify-content: center;
            transition: 0.3s;
        }
        .delete-btn:hover { background: #ef4444; color: white; }

        .submit-btn {
            background: var(--primary); color: white; border: none; padding: 15px 30px;
            border-radius: 30px; font-weight: bold; cursor: pointer; width: 100%; font-size: 1.1rem;
            transition: 0.3s;
        }
        .submit-btn:hover { background: #9a3412; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Dark Mode */
        body.dark-mode .feedback-form-card, body.dark-mode .review-card { background: #1e293b; border-color: #334155; }
        body.dark-mode .form-input { background: #334155; border-color: #475569; color: white; }
        body.dark-mode .review-text { color: #cbd5e1; }
        body.dark-mode .reviewer-name { color: white; }
    </style>
</head>
<body>

    <div class="access-bar">
        <div class="access-controls">
            <button onclick="toggleDarkMode()"><i class="fa-solid fa-moon"></i></button>
            <div class="font-controls">
                <button onclick="changeFontSize(1)">+A</button>
                <button onclick="changeFontSize(0)">A</button>
                <button onclick="changeFontSize(-1)">-A</button>
            </div>
        </div>
        <select id="lang-select" onchange="changeFeedbackLanguage()">
            <option value="en">English</option>
            <option value="mr">मराठी</option>
            <option value="hi">हिन्दी</option>
        </select>
    </div>

    <header>
        <div class="logo-container">
            <div class="royal-seal"><i class="fa-solid fa-chess-rook"></i></div>
        </div>
        <div class="title-container">
            <h1 id="txt-title">SHREE SAMBHAJI RAJE HOUSING SOCIETY</h1>
            <p id="txt-subtitle">Excellence in Community Living</p>
        </div>
    </header>

    <div class="feedback-container">
        
        <div class="feedback-form-card">
            <h2 id="txt-form-title" style="text-align:center; color:var(--primary); margin-bottom:10px;">Share Your Experience</h2>
            <p id="txt-form-sub" style="text-align:center; color:#64748b; margin-bottom:30px;">Your feedback helps us improve our society.</p>
            
            <div class="form-group">
                <label id="lbl-name">Full Name</label>
                <input type="text" id="inp-name" class="form-input" placeholder="Enter your name">
            </div>

            <div class="form-group">
                <label id="lbl-contact">Contact (Email or Phone)</label>
                <input type="text" id="inp-contact" class="form-input" placeholder="e.g. 9822XXXXXX or email@example.com">
            </div>

            <div class="form-group">
                <label id="lbl-rating">Rate Us</label>
                <div class="star-rating">
                    <input type="radio" name="rating" id="star5" value="5"><label for="star5" title="Excellent"><i class="fa-solid fa-star"></i></label>
                    <input type="radio" name="rating" id="star4" value="4"><label for="star4" title="Good"><i class="fa-solid fa-star"></i></label>
                    <input type="radio" name="rating" id="star3" value="3"><label for="star3" title="Average"><i class="fa-solid fa-star"></i></label>
                    <input type="radio" name="rating" id="star2" value="2"><label for="star2" title="Poor"><i class="fa-solid fa-star"></i></label>
                    <input type="radio" name="rating" id="star1" value="1"><label for="star1" title="Very Poor"><i class="fa-solid fa-star"></i></label>
                </div>
            </div>

            <div class="form-group">
                <label id="lbl-message">Your Message</label>
                <textarea id="inp-message" class="form-input" rows="4" placeholder="Write your feedback here..."></textarea>
            </div>

            <button onclick="submitFeedback()" class="submit-btn" id="btn-submit">Submit Feedback</button>
        </div>

        <h3 id="txt-recent-title" style="margin-bottom:20px; color:var(--secondary); border-left:5px solid var(--primary); padding-left:15px;">Recent Resident Reviews</h3>
        
        <div id="reviews-container" class="review-list">
            </div>

    </div>

    <footer>
        <div class="copyright">
            &copy; 2026 Shree Sambhaji Raje Housing Society | Feedback Portal
        </div>
    </footer>

   
    <script>
        // --- CONFIGURATION ---
        // PASTE YOUR GOOGLE SCRIPT WEB APP URL HERE
        const API_URL = "https://script.google.com/macros/s/AKfycbxnDGjqImP1C9U-CPFKd39u3NSW6YNJUyBLCgtq3yyLARaAE_MgOq2JadfiEX8JlLIu/exec"; 

        // --- 1. BAD WORD FILTER ---
        const badWords = ["bad", "worst", "hate", "stupid", "useless", "trash", "rubbish", "fake", "idiot"];

        function containsBadWords(text) {
            const lowerText = text.toLowerCase();
            return badWords.some(word => lowerText.includes(word));
        }

        // --- 2. SUBMIT FEEDBACK (To Google Sheet) ---
        function submitFeedback() {
            const name = document.getElementById('inp-name').value;
            const contact = document.getElementById('inp-contact').value;
            const message = document.getElementById('inp-message').value;
            
            let rating = 0;
            const stars = document.getElementsByName('rating');
            for(let star of stars) if(star.checked) rating = star.value;

            // Validations
            if(!name || !contact || !message || rating == 0) {
                alert("Please fill all fields and select a star rating.");
                return;
            }

            if(containsBadWords(message) || containsBadWords(name)) {
                alert("Warning: Inappropriate language detected.");
                return;
            }

            // Show Loading State
            const btn = document.getElementById('btn-submit');
            const originalText = btn.innerText;
            btn.innerText = "Saving to Database...";
            btn.disabled = true;

            // Prepare Data for Google Sheet
            const formData = new FormData();
            formData.append('action', 'addFeedback');
            formData.append('id', Date.now()); // Unique ID for deletion
            formData.append('name', name);
            formData.append('contact', contact);
            formData.append('rating', rating);
            formData.append('message', message);

            // Send to Server
            fetch(API_URL, {
                method: 'POST',
                body: formData
            })
            .then(res => res.json())
            .then(response => {
                alert("Thank you! Your feedback has been saved globally.");
                
                // Clear Form
                document.getElementById('inp-name').value = "";
                document.getElementById('inp-contact').value = "";
                document.getElementById('inp-message').value = "";
                for(let star of stars) star.checked = false;
                
                // Reload list
                loadFeedback();
                
                // Reset Button
                btn.innerText = originalText;
                btn.disabled = false;
            })
            .catch(error => {
                alert("Error saving feedback. Check internet connection.");
                btn.innerText = originalText;
                btn.disabled = false;
            });
        }

        // --- 3. LOAD FEEDBACK (From Google Sheet) ---
        function loadFeedback() {
            const container = document.getElementById('reviews-container');
            container.innerHTML = "<p style='text-align:center; padding:20px;'>Loading reviews from server...</p>";

            fetch(API_URL + "?action=getFeedback")
            .then(res => res.json())
            .then(data => {
                container.innerHTML = ""; // Clear loader

                if(data.length === 0) {
                    container.innerHTML = "<p style='text-align:center; color:#888;'>No reviews yet. Be the first to rate us!</p>";
                    return;
                }

                data.forEach(row => {
                   
                    
                    const id = row[0];
                    const dateRaw = new Date(row[1]);
                    const dateStr = dateRaw.toLocaleDateString();
                    const name = row[2];
                    
                    const rating = row[4];
                    const message = row[5];

                    // Generate Stars
                    let starHtml = "";
                    for(let i=0; i<rating; i++) starHtml += '<i class="fa-solid fa-star"></i> ';
                    for(let i=rating; i<5; i++) starHtml += '<i class="fa-regular fa-star"></i> ';

                    const html = `
                        <div class="review-card">
                            <button class="delete-btn" onclick="deleteFeedback('${id}')"><i class="fa-solid fa-trash"></i></button>
                            <div class="review-header">
                                <div>
                                    <div class="reviewer-name">${name}</div>
                                    <div class="review-date">${dateStr} • ${contact}</div>
                                </div>
                            </div>
                            <div class="review-stars">${starHtml}</div>
                            <div class="review-text">"${message}"</div>
                        </div>
                    `;
                    container.innerHTML += html;
                });
            });
        }

        // --- 4. SECURE DELETE (Server Side) ---
        function deleteFeedback(id) {
            const password = prompt("ADMIN ACCESS ONLY: Enter passcode to delete this review.");
            
            // PASSWORD IS 'sambaji'
            if(password === "sambaji") {
                
                // Optimistic UI update (optional): 
                // We could remove it from HTML immediately, but let's wait for server.
                const confirmBtn = confirm("Are you sure? This will permanently delete it from the Database.");
                if(!confirmBtn) return;

                const formData = new FormData();
                formData.append('action', 'deleteFeedback');
                formData.append('id', id);

                fetch(API_URL, {
                    method: 'POST',
                    body: formData
                })
                .then(res => res.json())
                .then(data => {
                    if(data.result === "deleted") {
                        alert("Review deleted successfully.");
                        loadFeedback(); // Refresh the list
                    } else {
                        alert("Could not find review to delete.");
                    }
                });

            } else if (password !== null) {
                alert("Incorrect Password! You cannot delete this review.");
            }
        }

        // --- 5. TRANSLATIONS (Keep existing logic) ---
        const fbTranslations = {
            en: {
                title: "SHREE SAMBHAJI RAJE HOUSING SOCIETY", sub: "Excellence in Community Living",
                formTitle: "Share Your Experience", formSub: "Your feedback helps us improve our society.",
                lblName: "Full Name", lblContact: "Contact (Email or Phone)", lblRating: "Rate Us", lblMsg: "Your Message",
                btnSubmit: "Submit Feedback", recentTitle: "Recent Resident Reviews"
            },
            mr: {
                title: "श्री संभाजी राजे हाऊसिंग सोसायटी", sub: "सामुदायिक जीवनातील उत्कृष्टता",
                formTitle: "आपला अनुभव शेअर करा", formSub: "तुमचा अभिप्राय आम्हाला सुधारण्यास मदत करतो.",
                lblName: "पूर्ण नाव", lblContact: "संपर्क (ईमेल किंवा फोन)", lblRating: "रेटिंग द्या", lblMsg: "तुमचा संदेश",
                btnSubmit: "अभिप्राय सबमिट करा", recentTitle: "रहिवाशांचे अलीकडील अभिप्राय"
            },
            hi: {
                title: "श्री संभाजी राजे हाउसिंग सोसाइटी", sub: "सामुदायिक जीवन में उत्कृष्टता",
                formTitle: "अपना अनुभव साझा करें", formSub: "आपकी प्रतिक्रिया हमें बेहतर बनाने में मदद करती है।",
                lblName: "पूरा नाम", lblContact: "संपर्क (ईमेल या फोन)", lblRating: "रेटिंग दें", lblMsg: "आपका संदेश",
                btnSubmit: "प्रतिक्रिया जमा करें", recentTitle: "हाल की समीक्षाएं"
            }
        };

        function changeFeedbackLanguage() {
            const lang = document.getElementById('lang-select').value;
            localStorage.setItem('societyLang', lang); // SAVE

            const t = fbTranslations[lang];

            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-subtitle').innerText = t.sub;
            document.getElementById('txt-form-title').innerText = t.formTitle;
            document.getElementById('txt-form-sub').innerText = t.formSub;
            document.getElementById('lbl-name').innerText = t.lblName;
            document.getElementById('lbl-contact').innerText = t.lblContact;
            document.getElementById('lbl-rating').innerText = t.lblRating;
            document.getElementById('lbl-message').innerText = t.lblMsg;
            document.getElementById('btn-submit').innerText = t.btnSubmit;
            document.getElementById('txt-recent-title').innerText = t.recentTitle;

           if(lang === 'en') document.body.classList.remove('lang-sanskrit');
            else document.body.classList.add('lang-sanskrit');
        }

        // INITIALIZE (Combine with loadFeedback)
        window.onload = function() {
            // 1. Load Language
            const savedLang = localStorage.getItem('societyLang') || 'en';
            document.getElementById('lang-select').value = savedLang;
            changeFeedbackLanguage();
            
        }
        

        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
        let currentSize = 16;
        function changeFontSize(n) {
            if (n === 0) currentSize = 16;
            else currentSize += n;
            if(currentSize > 24) currentSize = 24;
            if(currentSize < 12) currentSize = 12;
            document.documentElement.style.setProperty('--base-size', currentSize + 'px');
        }

        // Initialize
        window.onload = loadFeedback;

    </script>
</body>
</html>
