<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complaint Register - Shree Sambhaji Raje HSG SOC</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Tiro+Devanagari+Marathi&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="assest/image/society.png">

    <style>
        :root { --primary: #c2410c; --secondary: #1e293b; --bg-light: #f1f5f9; --text-dark: #333; --base-size: 16px; }
        
        body {
            font-family: 'Times New Roman', Times, serif; /* User Request */
            background: var(--bg-light); color: var(--text-dark);
            margin: 0; font-size: var(--base-size); transition: 0.3s;
        }
        body.dark-mode { background: #0f172a; color: #e2e8f0; --bg-light: #0f172a; --text-dark: #e2e8f0; }

        /* --- ACCESS BAR (Language & Font Adjuster) --- */
        .access-bar {
            background: var(--secondary); color: white; padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
            font-family: sans-serif; font-size: 0.9rem;
        }
        .access-controls button {
            background: rgba(255,255,255,0.2); border: none; color: white;
            padding: 5px 10px; cursor: pointer; border-radius: 4px; margin-left: 5px;
        }
        .access-controls button:hover { background: var(--primary); }
        .lang-select { padding: 5px; border-radius: 4px; border: none; }

        /* --- HEADER --- */
        header { text-align: center; padding: 40px 20px; }
        .royal-seal { font-size: 3rem; color: var(--primary); margin-bottom: 15px; }
        h1 { font-family: 'Playfair Display', serif; margin: 0; color: var(--primary); }
        .sanskrit-sub { font-family: 'Tiro Devanagari Marathi', serif; color: var(--secondary); margin-top: 5px; }

        /* --- CONTAINER & CARD --- */
        .container { max-width: 800px; margin: 0 auto 50px auto; padding: 0 20px; }
        
        .royal-card {
            background: white; border-radius: 20px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border-top: 5px solid var(--primary);
            padding: 40px; position: relative;
        }
        body.dark-mode .royal-card { background: #1e293b; border-color: #c2410c; }

        /* --- FORM ELEMENTS --- */
        .form-input {
            width: 100%; padding: 12px; margin: 10px 0;
            border: 1px solid #ccc; border-radius: 8px;
            font-family: 'Times New Roman', serif; font-size: 1rem;
            box-sizing: border-box;
        }
        .btn {
            background: var(--primary); color: white; padding: 12px 30px;
            border: none; border-radius: 30px; cursor: pointer; font-size: 1.1rem;
            width: 100%; margin-top: 15px; transition: 0.3s;
        }
        .btn:hover { background: #9a3412; }
        .btn:disabled { background: gray; cursor: not-allowed; }
        
        /* --- UTILS --- */
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.8s; }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

        /* Footer */
        footer { text-align: center; padding: 20px; background: var(--secondary); color: white; margin-top: 50px; }

    </style>
</head>
<body>

    <div class="access-bar">
        <div class="brand">SSRHS Portal</div>
        <div class="access-controls">
            <button onclick="toggleDarkMode()" title="Dark Mode"><i class="fa-solid fa-moon"></i></button>
            <button onclick="changeFontSize(-1)">A-</button>
            <button onclick="changeFontSize(0)">A</button>
            <button onclick="changeFontSize(1)">A+</button>
            <select id="lang-select" class="lang-select" onchange="changeLanguage()">
                <option value="en">English</option>
                <option value="mr">मराठी</option>
                <option value="hi">हिन्दी</option>
            </select>
        </div>
    </div>

    <header>
        <div class="royal-seal"><i class="fa-solid fa-chess-rook"></i></div>
        <h1 id="txt-title">SHREE SAMBHAJI RAJE HOUSING SOCIETY</h1>
        <p class="sanskrit-sub" id="txt-sub">Excellence in Community Living</p>
    </header>

    <div class="container">
        <div class="royal-card">
            
            <div id="gatekeeper" style="text-align:center;">
                <h2 class="sanskrit-sub">Secure Verification Required</h2>
                <p>Enter Society Access Password</p>
                <input type="password" id="gate-pass" class="form-input" placeholder="Password..." style="text-align:center; width:60%;">
                <button onclick="verifyGatekeeper()" class="btn" style="width:60%;">Enter</button>
            </div>

            <div id="main-form" class="hidden fade-in">
                <h2 class="sanskrit-sub" style="border-bottom:1px solid #ccc; padding-bottom:10px;">Register Complaint</h2>

                <form id="complaintForm" onsubmit="submitForm(event)">
                    
                    <label>Full Name</label>
                    <input type="text" id="inp-name" class="form-input" required>

                    <label>Phone Number (OTP Verification)</label>
                    <div style="display:flex; gap:10px;">
                        <input type="tel" id="inp-phone" class="form-input" placeholder="10 Digit Mobile" maxlength="10">
                        <button type="button" id="btn-otp" onclick="sendOTP()" class="btn" style="width:auto; margin-top:10px;">Get OTP</button>
                    </div>
                    
                    <div id="otp-box" class="hidden" style="background:#fff7ed; padding:10px; margin-top:5px; border-radius:5px;">
                        <small>OTP Sent! Enter below:</small>
                        <div style="display:flex; gap:10px;">
                            <input type="text" id="otp-val" class="form-input" placeholder="XXXX" style="width:100px;">
                            <button type="button" onclick="verifyOTP()" class="btn" style="width:auto; padding:5px 15px; margin-top:10px;">Verify</button>
                        </div>
                    </div>
                    <p id="otp-success" style="color:green; display:none;">✔ Phone Verified</p>

                    <label>Email ID</label>
                    <input type="email" id="inp-email" class="form-input" required>

                    <label>Complaint Type</label>
                    <select id="inp-type" class="form-input" required>
                        <option value="Water">Water Supply</option>
                        <option value="Electricity">Electricity</option>
                        <option value="Security">Security</option>
                        <option value="Other">Other</option>
                    </select>

                    <label>Description (Max 250 words)</label>
                    <textarea id="inp-desc" class="form-input" rows="4" required></textarea>

                    <label>Attachment (Optional)</label>
                    <input type="file" id="inp-file" class="form-input">

                    <button type="submit" id="btn-submit" class="btn" disabled>Submit Complaint</button>
                </form>
            </div>

        </div>
    </div>

    <footer>
        &copy; 2026 Shree Sambhaji Raje Housing Society
    </footer>

    <script>
        // *** 1. UNIVERSAL LOGIC (Adjuster Mode) ***
        let currentSize = parseInt(localStorage.getItem('societyFont')) || 16;
        document.documentElement.style.setProperty('--base-size', currentSize + 'px');

        function changeFontSize(n) {
            if(n === 0) currentSize = 16;
            else currentSize += n;
            document.documentElement.style.setProperty('--base-size', currentSize + 'px');
            localStorage.setItem('societyFont', currentSize);
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('societyTheme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        // Translation Data
        const trans = {
            en: { title: "SHREE SAMBHAJI RAJE HOUSING SOCIETY", sub: "Excellence in Community Living" },
            mr: { title: "श्री संभाजी राजे हाऊसिंग सोसायटी", sub: "सामुदायिक जीवनातील उत्कृष्टता" },
            hi: { title: "श्री संभाजी राजे हाउसिंग सोसाइटी", sub: "सामुदायिक जीवन में उत्कृष्टता" }
        };

        function changeLanguage() {
            const lang = document.getElementById('lang-select').value;
            localStorage.setItem('societyLang', lang);
            document.getElementById('txt-title').innerText = trans[lang].title;
            document.getElementById('txt-sub').innerText = trans[lang].sub;
        }

        // Init Load
        window.onload = function() {
            if(localStorage.getItem('societyTheme') === 'dark') document.body.classList.add('dark-mode');
            const savedLang = localStorage.getItem('societyLang') || 'en';
            document.getElementById('lang-select').value = savedLang;
            changeLanguage();
        };

        // *** 2. COMPLAINT LOGIC ***
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwdTSU2fyLyt_0EItEbu2ZVTDMfo8_-ti7NWyKX2tH3UjaF0MsbP5aSS3bd03QD1TJAtw/exec"; 
        const PASS_HASH = "60d7158583af707f282fe8fb4da970590817d9bdc24b2bd7c76b2315902ccf63"; // Hash for Sambhaji@2026
        let generatedOTP = null;

        // A. Gatekeeper
        async function verifyGatekeeper() {
            const val = document.getElementById('gate-pass').value;
            const msgBuffer = new TextEncoder().encode(val);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            
            if(hashHex === PASS_HASH) {
                document.getElementById('gatekeeper').style.display = 'none';
                document.getElementById('main-form').classList.remove('hidden');
            } else {
                alert("Incorrect Password");
            }
        }

        // B. OTP
        function sendOTP() {
            const phone = document.getElementById('inp-phone').value;
            if(phone.length < 10) return alert("Invalid Phone");
            generatedOTP = Math.floor(1000 + Math.random() * 9000);
            alert("OTP: " + generatedOTP); // Simulation
            document.getElementById('otp-box').classList.remove('hidden');
            document.getElementById('btn-otp').style.display = 'none';
        }

        function verifyOTP() {
            if(document.getElementById('otp-val').value == generatedOTP) {
                document.getElementById('otp-box').style.display = 'none';
                document.getElementById('otp-success').style.display = 'block';
                document.getElementById('btn-submit').disabled = false;
            } else {
                alert("Wrong OTP");
            }
        }

        // C. Submit
        function submitForm(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            btn.innerHTML = "Saving...";
            btn.disabled = true;

            const fileInput = document.getElementById('inp-file');
            const reader = new FileReader();
            
            let payload = {
                name: document.getElementById('inp-name').value,
                phone: document.getElementById('inp-phone').value,
                email: document.getElementById('inp-email').value,
                type: document.getElementById('inp-type').value,
                desc: document.getElementById('inp-desc').value,
                fileData: "", fileName: "", fileMime: ""
            };

            const send = () => {
                fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(payload) })
                .then(r => r.json())
                .then(d => {
                    if(d.status === "success") {
                        alert(`Success!\nComplaint ID: ${d.id}\nPassword: ${d.pass}\nRedirecting...`);
                        window.location.href = "index.html";
                    } else {
                        alert("Error: " + d.message);
                        btn.disabled = false;
                    }
                });
            };

            if(fileInput.files.length > 0) {
                const f = fileInput.files[0];
                payload.fileName = f.name; payload.fileMime = f.type;
                reader.onload = (e) => { payload.fileData = e.target.result.split(',')[1]; send(); };
                reader.readAsDataURL(f);
            } else { send(); }
        }
    </script>
</body>
</html>