<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Portal - Shree Sambhaji Raje Housing Society</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assest/style.css">
    
    <style>
        /* Specific Member Page Styles */
        .auth-container {
            max-width: 450px;
            margin: 40px auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border-top: 5px solid var(--primary);
        }
        
        body.dark-mode .auth-container {
            background: #1e293b;
            border-color: #fbbf24;
        }

        .toggle-btns {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid #e2e8f0;
        }

        .toggle-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            color: #94a3b8;
            font-family: var(--font-eng);
        }

        .toggle-btn.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }
        
        body.dark-mode .toggle-btn.active { color: #fbbf24; border-color: #fbbf24; }

        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1rem;
            background: #f8fafc;
        }
        
        body.dark-mode input, body.dark-mode select {
            background: #0f172a; border-color: #475569; color: white;
        }

        .otp-group { display: flex; gap: 10px; }
        .verify-btn {
            padding: 0 15px;
            background: #0f172a;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: 0.3s;
        }

        .submit-btn:hover { background: #9a3412; }
        
        .hidden { display: none; }
        
        .terms { font-size: 0.85rem; display: flex; align-items: flex-start; gap: 10px; }
        
        /* Loading Overlay */
        .loader {
            display: none;
            text-align: center;
            margin-top: 10px;
            color: var(--primary);
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="access-bar">
        <div class="access-controls">
            <button onclick="toggleDarkMode()"><i class="fa-solid fa-moon"></i></button>
            <button onclick="window.location.href='index.html'"><i class="fa-solid fa-home"></i> Back</button>
        </div>
    </div>

    <header style="padding: 20px;">
        <div class="logo-icon"><i class="fa-solid fa-users-rectangle"></i></div>
        <h1>Member Portal</h1>
    </header>

    <main>
        <div class="auth-container">
            <div class="toggle-btns">
                <button class="toggle-btn active" onclick="switchTab('login')">Login</button>
                <button class="toggle-btn" onclick="switchTab('register')">New Registration</button>
            </div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Login ID / Email / Phone</label>
                    <input type="text" id="loginId" placeholder="e.g. Anur14" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPass" placeholder="Enter password" required>
                </div>
                <button type="submit" class="submit-btn">Secure Login <i class="fa-solid fa-lock"></i></button>
            </form>

            <form id="regForm" class="hidden" onsubmit="handleRegister(event)">
                <div style="display: flex; gap: 10px;">
                    <div class="form-group" style="flex:1">
                        <label>First Name</label>
                        <input type="text" id="fname" required>
                    </div>
                    <div class="form-group" style="flex:1">
                        <label>Last Name</label>
                        <input type="text" id="lname" required>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <div class="form-group" style="flex:1">
                        <label>Age</label>
                        <input type="number" id="age" min="18" required>
                    </div>
                    <div class="form-group" style="flex:1">
                        <label>Gender</label>
                        <select id="gender">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Phone Number</label>
                    <div class="otp-group">
                        <input type="tel" id="phone" placeholder="10 Digit Mobile" pattern="[0-9]{10}" required>
                        <button type="button" class="verify-btn" onclick="sendOTP()">Verify</button>
                    </div>
                </div>
                
                <div class="form-group hidden" id="otpField">
                    <label>Enter OTP (Simulated: 1234)</label>
                    <input type="text" id="otpInput" placeholder="Enter OTP">
                    <small style="color:green; display:none;" id="verifiedMsg">Verified <i class="fa-solid fa-check"></i></small>
                </div>

                <div class="form-group">
                    <label>Email (Optional)</label>
                    <input type="email" id="email" placeholder="name@example.com">
                </div>

                <div class="form-group">
                    <label>Residential Address</label>
                    <select id="address1" required onchange="updateSubAddress()">
                        <option value="">Select Wing</option>
                        <option value="Wing A">Wing A</option>
                        <option value="Wing B">Wing B</option>
                        <option value="Row House">Row House</option>
                    </select>
                    <select id="address2" style="margin-top: 10px;">
                        <option value="">Select Flat No</option>
                        </select>
                </div>

                <div class="form-group terms">
                    <input type="checkbox" id="agree" required>
                    <label for="agree">I agree to the <a href="#" style="color:var(--primary)">Terms & Conditions</a> and Society Bylaws.</label>
                </div>

                <button type="submit" class="submit-btn" id="regBtn" disabled>Submit Application</button>
            </form>
            
            <div id="loader" class="loader"><i class="fa-solid fa-circle-notch fa-spin"></i> Processing...</div>
        </div>
    </main>

    <footer>
        <div class="copyright">Â© 2026 Shree Sambaji Raje Housing Society</div>
    </footer>

    <script>
        // PASTE YOUR GOOGLE SCRIPT WEB APP URL HERE
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwMxbgl4CelbIyiXwXRj-U6vmYdls7ZfVBtArx4BYkr24ifbf2trVbPGSU1vtV-K1lV/exec"; 

        // 1. Toggle Tabs
        function switchTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const regForm = document.getElementById('regForm');
            const btns = document.querySelectorAll('.toggle-btn');

            if(tab === 'login') {
                loginForm.classList.remove('hidden');
                regForm.classList.add('hidden');
                btns[0].classList.add('active');
                btns[1].classList.remove('active');
            } else {
                loginForm.classList.add('hidden');
                regForm.classList.remove('hidden');
                btns[0].classList.remove('active');
                btns[1].classList.add('active');
            }
        }

        // 2. Address Logic
        function updateSubAddress() {
            const wing = document.getElementById('address1').value;
            const flatSelect = document.getElementById('address2');
            flatSelect.innerHTML = ""; // Clear

            let count = 0;
            if(wing === 'Wing A' || wing === 'Wing B') count = 12; // 12 flats per wing
            else if(wing === 'Row House') count = 5;

            for(let i=1; i<=count; i++) {
                let opt = document.createElement('option');
                opt.value = (wing === 'Row House' ? 'RH-' : 'Flat ') + (i < 10 ? '0'+i : i);
                opt.innerHTML = opt.value;
                flatSelect.appendChild(opt);
            }
        }

        // 3. OTP Simulation (Client Side Only for Demo)
        let isPhoneVerified = false;
        function sendOTP() {
            const phone = document.getElementById('phone').value;
            if(phone.length !== 10) { alert("Please enter valid 10 digit number"); return; }
            
            alert("OTP Sent to " + phone + "\n(For this demo, OTP is 1234)");
            document.getElementById('otpField').classList.remove('hidden');
            
            // Listen for OTP input
            document.getElementById('otpInput').addEventListener('input', function(e){
                if(e.target.value === "1234") {
                    isPhoneVerified = true;
                    document.getElementById('verifiedMsg').style.display = 'block';
                    document.getElementById('regBtn').disabled = false;
                    e.target.style.borderColor = "green";
                }
            });
        }

        // 4. Handle Registration Submit
        function handleRegister(e) {
            e.preventDefault();
            if(!isPhoneVerified) { alert("Please Verify Phone Number First"); return; }
            
            const loader = document.getElementById('loader');
            loader.style.display = "block";
            
            // Gather Data
            const formData = new FormData();
            formData.append('action', 'register');
            formData.append('fname', document.getElementById('fname').value);
            formData.append('lname', document.getElementById('lname').value);
            formData.append('age', document.getElementById('age').value);
            formData.append('gender', document.getElementById('gender').value);
            formData.append('phone', document.getElementById('phone').value);
            formData.append('email', document.getElementById('email').value);
            formData.append('address', document.getElementById('address1').value + " - " + document.getElementById('address2').value);

            fetch(SCRIPT_URL, { method: 'POST', body: formData })
            .then(res => res.json())
            .then(data => {
                loader.style.display = "none";
                alert("Application Submitted Successfully!\n\nThe Admin will verify your details and generate your Login ID (e.g., Name + Age) and send it to your email/phone.\n\nDefault Password will be: society2017");
                switchTab('login');
                document.getElementById('regForm').reset();
            })
            .catch(err => {
                loader.style.display = "none";
                alert("Error submitting form. Please try again.");
                console.error(err);
            });
        }

        // 5. Handle Login
        function handleLogin(e) {
            e.preventDefault();
            const loader = document.getElementById('loader');
            loader.style.display = "block";

            const formData = new FormData();
            formData.append('action', 'login');
            formData.append('username', document.getElementById('loginId').value);
            formData.append('password', document.getElementById('loginPass').value);

            fetch(SCRIPT_URL, { method: 'POST', body: formData })
            .then(res => res.json())
            .then(data => {
                loader.style.display = "none";
                if(data.result === "success") {
                    // Save session
                    localStorage.setItem("user_name", data.name);
                    localStorage.setItem("is_logged_in", "true");
                    window.location.href = "Dashboard.html"; // Redirect
                } else {
                    alert("Invalid ID or Password. Please try again.");
                }
            })
            .catch(err => {
                loader.style.display = "none";
                alert("Connection Error.");
            });
        }
        
        // Dark Mode Script (Reused)
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }
    </script>
</body>
</html>