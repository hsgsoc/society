<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Portal - Shree Sambhaji Raje Housing Society</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assest/style.css">
    
    <style>
        /* --- AUTH CONTAINER --- */
        .auth-container {
            max-width: 450px;
            margin: 40px auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            border-top: 5px solid var(--primary);
            transition: background 0.4s;
        }
        
        body.dark-mode .auth-container {
            background: #1e293b;
            border-color: #fbbf24;
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
        }

        /* --- TOGGLE BUTTONS --- */
        .toggle-btns {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid #e2e8f0;
        }
        body.dark-mode .toggle-btns { border-color: #334155; }

        .toggle-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            color: #94a3b8;
            font-family: var(--font-eng);
            transition: 0.3s;
        }

        .toggle-btn.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }
        body.dark-mode .toggle-btn.active { color: #fbbf24; border-color: #fbbf24; }

        /* --- FORM ELEMENTS --- */
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; color: var(--text-light); }
        body.dark-mode .form-group label { color: #cbd5e1; }

        /* MODERN INPUTS & DROPDOWNS */
        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            background-color: #f8fafc;
            color: #334155;
            transition: 0.3s;
            outline: none;
        }

        /* Dropdown Specifics (Remove default arrow, add custom) */
        .form-group select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23c2410c%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 15px top 50%;
            background-size: 12px auto;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(194, 65, 12, 0.1);
        }

        /* DARK MODE INPUTS */
        body.dark-mode .form-group input, 
        body.dark-mode .form-group select {
            background-color: #0f172a; /* Dark background */
            border-color: #334155;
            color: #ffffff; /* White Text */
            /* Change arrow color to Gold for dark mode */
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23fbbf24%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        }
        
        body.dark-mode .form-group input:focus, 
        body.dark-mode .form-group select:focus {
            border-color: #fbbf24;
            background: #1e293b;
        }

        /* OTP & BUTTONS */
        .otp-group { display: flex; gap: 10px; }
        .verify-btn {
            padding: 0 20px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
        }
        /* Full-screen overlay for Loading/Success */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .status-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        body.dark-mode .status-card {
            background: #1e293b;
            color: white;
        }

        .status-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .spinner {
            animation: rotate 2s linear infinite;
        }

        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }
        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, #ea580c 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: transform 0.2s;
            box-shadow: 0 4px 15px rgba(194, 65, 12, 0.3);
        }
        .submit-btn:hover { transform: translateY(-2px); }
        .submit-btn:disabled { background: #cbd5e1; cursor: not-allowed; box-shadow: none; }

        .hidden { display: none; }
        .loader { display: none; text-align: center; margin-top: 15px; font-weight: bold; color: var(--primary); }
    </style>
</head>
<body>

    <div class="access-bar">
        <div class="access-controls">
            <button onclick="toggleDarkMode()"><i class="fa-solid fa-moon"></i></button>
            <button onclick="window.location.href='index.html'"><i class="fa-solid fa-home"></i> Back</button>
        </div>
    </div>

    <header style="padding: 20px;">
        <div class="logo-icon"><i class="fa-solid fa-users-rectangle"></i></div>
        <h1>Member Portal</h1>
    </header>

    <main>
        <div class="auth-container">
            <div class="toggle-btns">
                <button class="toggle-btn active" onclick="switchTab('login')">Login</button>
                <button class="toggle-btn" onclick="switchTab('register')">New Registration</button>
            </div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Login ID / Phone</label>
                    <input type="text" id="loginId" placeholder="e.g. Anur14" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPass" placeholder="Enter password" required>
                </div>
                <button type="submit" class="submit-btn">Secure Login <i class="fa-solid fa-lock"></i></button>
            </form>

            <form id="regForm" class="hidden" onsubmit="handleRegister(event)">
                <div style="display: flex; gap: 10px;">
                    <div class="form-group" style="flex:1">
                        <label>First Name</label>
                        <input type="text" id="fname" required>
                    </div>
                    <div class="form-group" style="flex:1">
                        <label>Last Name</label>
                        <input type="text" id="lname" required>
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <div class="form-group" style="flex:1">
                        <label>Age</label>
                        <input type="number" id="age" min="18" required>
                    </div>
                    <div class="form-group" style="flex:1">
                        <label>Gender</label>
                        <select id="gender">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Phone Number</label>
                    <div class="otp-group">
                        <input type="tel" id="phone" placeholder="10 Digit Mobile" pattern="[0-9]{10}" required>
                        <button type="button" class="verify-btn" onclick="sendOTP()">Verify</button>
                    </div>
                </div>
                
                <div class="form-group hidden" id="otpField">
                    <label>Enter OTP (Type: 1234)</label>
                    <input type="text" id="otpInput" placeholder="Enter OTP">
                    <small style="color:green; display:none;" id="verifiedMsg">Verified <i class="fa-solid fa-check"></i></small>
                </div>

                <div class="form-group">
                    <label>Email (Optional)</label>
                    <input type="email" id="email" placeholder="name@example.com">
                </div>

                <div class="form-group">
                    <label>Residential Address</label>
                    <select id="address1" required onchange="updateSubAddress()">
                        <option value="">Select Wing</option>
                        <option value="Shree Sambhaji Raje HSG SOC, ganesh nagar, Talwade Road, Pune , Maharashtra">Shree Sambhaji Raje HSG SOC, ganesh nagar, Talwade Road, Pune , Maharashtra</option>
                        <option value="Not Avialable">Not Avialable</option>
                       
                    </select>
                    <div style="height: 15px;"></div> 
                    <select id="address2">
                        <option value="">Select Society No.</option>
                         <option value="">Society Road 1(SSRHS)</option>
                         <option value="">Society Road 2(SSRHS)</option>
                    </select>
                </div>

                <div class="form-group terms" style="display:flex; align-items:center; gap:10px; font-size:0.9rem;">
                    <input type="checkbox" id="agree" required style="width:20px;">
                    <label for="agree" style="margin:0;">I agree to the <a href="#" style="color:var(--primary)">Terms</a> & Bylaws.</label>
                </div>

                <button type="submit" class="submit-btn" id="regBtn" disabled>Submit Application</button>
            </form>
            
            <div id="loader" class="loader"><i class="fa-solid fa-circle-notch fa-spin"></i> Processing...</div>
        </div>
    </main>

    <footer>
        <div class="copyright">Â© 2026 Shree Sambaji Raje Housing Society</div>
    </footer>

    <script>
      
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzqs3Y8VZx_f_zgPxpxrf8on_ga8_EF8TbEWCVr4_-eEOsaaubdf1_3K4Nr-v50Bbee/exec"; 

        // 1. Toggle Tabs
        function switchTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const regForm = document.getElementById('regForm');
            const btns = document.querySelectorAll('.toggle-btn');
            
            document.getElementById('loader').style.display = 'none'; // reset loader

            if(tab === 'login') {
                loginForm.classList.remove('hidden');
                regForm.classList.add('hidden');
                btns[0].classList.add('active');
                btns[1].classList.remove('active');
            } else {
                loginForm.classList.add('hidden');
                regForm.classList.remove('hidden');
                btns[0].classList.remove('active');
                btns[1].classList.add('active');
            }
        }

       function updateSubAddress() {
    const wing = document.getElementById('address1').value;
    const flatSelect = document.getElementById('address2');
    
    // Clear existing options
    flatSelect.innerHTML = ""; 

    let count = 0;
    let prefix = "";

    if (wing === "Shree Sambhaji Raje HSG SOC, ganesh nagar, Talwade Road, Pune , Maharashtra") {
        // For the main society, we show 5 Society Roads
        count = 2;
        prefix = "Society Road ";
        
        // Default placeholder for this selection
        let placeholder = document.createElement('option');
        placeholder.value = "";
        placeholder.innerText = "Select Society Road";
        flatSelect.appendChild(placeholder);

        for (let i = 1; i <= count; i++) {
            let opt = document.createElement('option');
            let val = prefix + i + " (SSRHS)";
            opt.value = val;
            opt.innerText = val;
            flatSelect.appendChild(opt);
        }
    } 
    else if (wing === "Not Avialable") {
        // If Not Available is selected, just show one option: "Not Available"
        let opt = document.createElement('option');
        opt.value = "Not Available";
        opt.innerText = "Not Available";
        flatSelect.appendChild(opt);
    } 
    else {
        // Default placeholder when nothing is selected
        let opt = document.createElement('option');
        opt.value = "";
        opt.innerText = "Select Society No.";
        flatSelect.appendChild(opt);
    }
}

        // 3. OTP Simulation
        let isPhoneVerified = false;
        function sendOTP() {
            const phone = document.getElementById('phone').value;
            if(phone.length !== 10) { alert("Please enter valid 10 digit number"); return; }
            
            alert("OTP Sent to " + phone + "\n(Code: 1234)");
            document.getElementById('otpField').classList.remove('hidden');
            
            document.getElementById('otpInput').addEventListener('input', function(e){
                if(e.target.value === "1234") {
                    isPhoneVerified = true;
                    document.getElementById('verifiedMsg').style.display = 'block';
                    document.getElementById('regBtn').disabled = false;
                    e.target.style.borderColor = "green";
                }
            });
        }

        // 4. Handle Registration (UPDATED TO FIX ERROR)
        function handleRegister(e) {
            e.preventDefault();
            if(!isPhoneVerified) { alert("Please Verify Phone First"); return; }
            
            const loader = document.getElementById('loader');
            loader.style.display = "block";
            
            // USE URLSearchParams (Fixes the FormData error)
            const params = new URLSearchParams();
            params.append('action', 'register');
            params.append('fname', document.getElementById('fname').value);
            params.append('lname', document.getElementById('lname').value);
            params.append('age', document.getElementById('age').value);
            params.append('gender', document.getElementById('gender').value);
            params.append('phone', document.getElementById('phone').value);
            params.append('email', document.getElementById('email').value);
            params.append('address', document.getElementById('address1').value + " " + document.getElementById('address2').value);
fetch(SCRIPT_URL, { 
        method: 'POST', 
        body: params 
    })
    .then(res => {
        if (!res.ok) throw new Error("Network response was not ok");
        return res.json();
    })
    .then(data => {
        // Hide the loading overlay if you are using one
        if (document.getElementById('modalOverlay')) {
            document.getElementById('modalOverlay').style.display = 'none';
        }

        if(data.result === 'success') {
            // REDIRECT TO THANK YOU PAGE
            window.location.href = "thankyou.html"; 
        } else {
            // If the script returns an error (like sheet not found)
            window.location.href = "server-down.html";
        }
    })
    .catch(err => {
        console.error("Submission Error:", err);
        // If the server is down or internet is lost
        window.location.href = "server-down.html";
    });
        }

        // 5. Handle Login (UPDATED)
        function handleLogin(e) {
            e.preventDefault();
            const loader = document.getElementById('loader');
            loader.style.display = "block";

            const params = new URLSearchParams();
            params.append('action', 'login');
            params.append('username', document.getElementById('loginId').value);
            params.append('password', document.getElementById('loginPass').value);

            fetch(SCRIPT_URL, { 
                method: 'POST', 
                body: params 
            })
            .then(res => res.json())
            .then(data => {
                loader.style.display = "none";
                if(data.result === "success") {
                    localStorage.setItem("user_name", data.name);
                    localStorage.setItem("is_logged_in", "true");
                    window.location.href = "Dashboard.html";
                } else {
                    alert("Invalid ID or Password.");
                }
            })
            .catch(err => {
                loader.style.display = "none";
                alert("Login failed. Please try again.");
                console.error(err);
            });
        }
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }
    </script>
    <div id="modalOverlay" class="modal-overlay">
    <div class="status-card">
        <div id="statusIcon" class="status-icon">
            <i class="fa-solid fa-circle-notch spinner"></i>
        </div>
        <h2 id="statusTitle">Processing...</h2>
        <p id="statusMsg">Please do not refresh the page.</p>
        <button id="closeModal" class="submit-btn hidden" onclick="closeStatus()">Close</button>
    </div>
</div>
</body>
<script src="error-handler.js"></script>

<script>
    // If the page doesn't exist or returns 404 on GitHub
    if (document.title.includes("404")) {
        window.location.href = "server-down.html";
    }
</script>
</html>