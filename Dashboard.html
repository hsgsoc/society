<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Shree Sambhaji Raje Housing Society</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assest/style.css"> <link rel="icon" type="image/x-icon" href="assest/image/society.png">
    <style>
        style>
        /* --- CORE VARIABLES & RESET (Matching Login Page) --- */
        :root {
            --primary: #c2410c;
            --primary-dark: #9a3412;
            --secondary: #1e293b;
            --bg-light: #f1f5f9;
            --text-dark: #334155; /* Already Dark */
            --text-light: #334155; /* Changed from light gray (#64748b) to Dark Slate */
            --card-bg: #ffffff;
            --accent-gold: #fbbf24;
        }
        /* Update this section in your <style> tag */
        .user-name, 
        .user-profile h3, 
        .user-id, 
        .stat-info p,        /* This targets the 'Total Members' etc. */
        .welcome-text span,  /* This targets the date/loading text */
        .notice-date {       /* This targets the gray dates in notices */
            color: #1e293b !important; /* Deep Navy Dark */
            font-weight: 600;}
        /* Force Dark Text for User Name and Activity Labels */
        .user-name, .user-profile h3, .user-id {
            color: #1e293b !important; /* Deep Navy Dark */
            font-weight: 700;
        }

        /* Activity Table Text Color */
        #activityTableBody td, .activity-details {
            color: #334155 !important; /* Dark Slate Grey */
        }

        /* Ensuring labels inside cards are dark */
        .section-card h3, .stat-label {
            color: #0f172a !important;
        }

        /* --- DARK MODE ADJUSTMENTS --- */
        /* If you want the text to turn White only in Dark Mode */
        body.dark-mode .user-name, 
        body.dark-mode #activityTableBody td {
            color: #f8fafc !important; 
        }
        
/* --- ENQUIRY MODAL & STYLISH ALERT --- */
        .modal-overlay, .stylish-alert-overlay {
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.7);
            display: flex; 
            align-items: center; 
            justify-content: center; 
            z-index: 2000;
            backdrop-filter: blur(4px);
        }

        .modal-content, .stylish-alert-card {
            background: var(--card-bg); 
            padding: 25px; 
            border-radius: 20px; 
            width: 90%; 
            max-width: 450px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            position: relative;
            animation: modalSlideUp 0.3s ease-out;
        }

        @keyframes modalSlideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }
        /* Star Rating Widget */
        .rating-container { display: flex; justify-content: center; padding: 10px 0; }
        .star-widget { display: flex; flex-direction: row-reverse; }
        .star-widget input { display: none; }
        .star-widget label {
            font-size: 30px;
            color: #444;
            padding: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .star-widget input:not(:checked) ~ label:hover,
        .star-widget input:not(:checked) ~ label:hover ~ label { color: #fd4; }
        .star-widget input:checked ~ label { color: #fd4; text-shadow: 0 0 10px #952; }

        /* Readonly fields styling */
        #fbName, #fbID { background: #e2e8f0; cursor: not-allowed; }
        body.dark-mode #fbName, body.dark-mode #fbID { background: #0f172a; color: #94a3b8; }
        /* Form Layout */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        .form-grid input, .form-grid select, #enqText {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8fafc;
            color: var(--text-dark);
            font-size: 0.9rem;
            box-sizing: border-box;
        }

        #enqText {
            height: 100px;
            resize: none;
            margin-bottom: 12px;
        }

        /* Image Upload Section */
        .upload-section {
            background: #f1f5f9;
            padding: 10px;
            border-radius: 8px;
            border: 1px dashed #cbd5e1;
            text-align: center;
            margin-bottom: 15px;
        }

        .upload-section label {
            display: block;
            cursor: pointer;
            color: var(--text-light);
            font-size: 0.85rem;
        }

        #enqImg { display: none; }

        /* Buttons */
        .btn-primary-full {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-primary-full:hover { background: var(--primary-dark); }

        /* Stylish Alert Specifics */
        .stylish-alert-card { 
            text-align: center; 
            border-top: 6px solid var(--primary); 
        }

        .alert-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .review-body { 
            text-align: left; 
            background: #f1f5f9; 
            padding: 15px; 
            border-radius: 12px; 
            margin: 20px 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .alert-actions {
            display: flex;
            gap: 10px;
        }

        /* Dark Mode Overrides for Modal */
        body.dark-mode .form-grid input, 
        body.dark-mode .form-grid select, 
        body.dark-mode #enqText {
            background: #334155;
            border-color: #475569;
            color: white;
        }

        body.dark-mode .review-body {
            background: #0f172a;
            color: #cbd5e1;
        }

        /* Responsive Grid for Mobile */
        @media (max-width: 480px) {
            .form-grid { grid-template-columns: 1fr; }
        }
        .modal-content, .stylish-alert-card {
            background: white; padding: 25px; border-radius: 20px; width: 90%; max-width: 450px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stylish-alert-card { text-align: center; border-top: 5px solid #c2410c; }
        .review-body { text-align: left; background: #f8fafc; padding: 15px; border-radius: 12px; margin: 20px 0; }

        .btn-confirm { background: #c2410c; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; }
        .btn-cancel { background: #cbd5e1; color: #1e293b; border: none; padding: 10px 20px; border-radius: 8px; margin-right: 10px; }

        /* Dark mode compatibility */
        .dark-mode .modal-content, .dark-mode .stylish-alert-card { background: #1e293b; color: white; }
        .dark-mode .review-body { background: #334155; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            transition: background 0.3s, color 0.3s;
        }

        body.dark-mode {
            background-color: #0f172a;
            color: #e2e8f0;
            --card-bg: #1e293b;
            --text-dark: #f1f5f9;
            --text-light: #cbd5e1;
        }

        /* --- LAYOUT STRUCTURE --- */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px;
            background: var(--secondary);
            color: white;
            position: fixed;
            top: 0;
            left: -260px; /* Hidden by default */
            height: 100%;
            z-index: 1000;
            transition: left 0.3s ease-in-out;
            box-shadow: 4px 0 15px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            padding: 20px;
            background: rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }

        .sidebar-menu li a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: #cbd5e1;
            text-decoration: none;
            transition: 0.2s;
            border-left: 4px solid transparent;
        }

        .sidebar-menu li a:hover, .sidebar-menu li a.active {
            background: rgba(255,255,255,0.05);
            color: var(--accent-gold);
            border-left-color: var(--accent-gold);
        }

        .sidebar-menu li a i {
            margin-right: 15px;
            width: 20px;
            text-align: center;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        .sidebar-overlay.active { display: block; }

        /* --- MAIN CONTENT AREA --- */
        .main-content {
            flex: 1;
            width: 100%;
            transition: margin-left 0.3s;
        }

        /* --- TOP HEADER --- */
        .top-header {
            background: var(--card-bg);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 900;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--primary);
        }

        .welcome-text h2 {
            margin: 0;
            font-size: 1.2rem;
        }
        .welcome-text span {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .icon-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-light);
            position: relative;
            transition: 0.2s;
        }
        .icon-btn:hover { color: var(--primary); }

        .lang-select {
            padding: 5px 10px;
            border-radius: 20px;
            border: 1px solid #ddd;
            background: var(--card-bg);
            color: var(--text-dark);
            cursor: pointer;
        }

        /* User Profile Dropdown Styling */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* --- DASHBOARD WIDGETS --- */
        .content-wrapper {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.2s;
            border-bottom: 4px solid transparent;
        }
        
        .stat-card:hover { transform: translateY(-5px); }

        .stat-info h3 { margin: 0; font-size: 2rem; color: var(--text-dark); }
        .stat-info p { margin: 5px 0 0; color: var(--text-light); font-size: 0.9rem; }
        
        .stat-icon {
            font-size: 2.5rem;
            opacity: 0.2;
            color: var(--primary);
        }

        /* Colors for different cards */
        .card-1 { border-color: #3b82f6; } /* Members */
        .card-2 { border-color: #22c55e; } /* Active */
        .card-3 { border-color: #eab308; } /* House */
        .card-4 { border-color: #ef4444; } /* Requests */
        .card-5 { border-color: #a855f7; } /* Complaint */
        .card-6 { border-color: #06b6d4; } /* Enquiry */

        /* --- SECTIONS GRID --- */
        .sections-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }

        @media (max-width: 900px) {
            .sections-grid { grid-template-columns: 1fr; }
        }

        .section-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        body.dark-mode .section-header { border-color: #334155; }
        .section-header h3 { margin: 0; color: var(--primary); }

        /* Notice Board */
        .notice-list { list-style: none; padding: 0; }
        .notice-item {
            padding: 15px;
            border-left: 4px solid var(--accent-gold);
            background: rgba(251, 191, 36, 0.1);
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
        }
        .notice-date { font-size: 0.8rem; color: var(--text-light); font-weight: bold; }

        /* Festival Card */
        .festival-card {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            color: #333;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        body.dark-mode .festival-card {
            background: linear-gradient(135deg, #7f1d1d 0%, #c2410c 100%);
            color: white;
        }
        .festival-icon { font-size: 4rem; margin-bottom: 10px; }

        /* Gallery */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }
        .gallery-img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        .gallery-img:hover { opacity: 0.8; }

        /* Location */
        .map-container iframe {
            width: 100%;
            height: 250px;
            border: 0;
            border-radius: 10px;
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            .top-header { padding: 15px; }
            .header-right span { display: none; } /* Hide names on mobile */
            .content-wrapper { padding: 15px; }
        }
    </style>
</head>
<body>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3><i class="fa-solid fa-building-user"></i> SSRHS</h3>
            <button class="icon-btn" onclick="toggleSidebar()" style="color:white;"><i class="fa-solid fa-times"></i></button>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" class="active"><i class="fa-solid fa-chart-line"></i> <span data-key="nav_dashboard">Dashboard</span></a></li>
            <li><a href="#"><i class="fa-solid fa-info-circle"></i> <span data-key="nav_about">About Society</span></a></li>
            <li><a href="#"><i class="fa-solid fa-bullhorn"></i> <span data-key="nav_notice">Notice Board</span></a></li>
            <li> <a href="javascript:void(0)" onclick="openEnquiryModal()"> <i class="fa-solid fa-clipboard-question"></i>
                 <span data-key="nav_enquiry">Enquiry</span>
                 </a> 
                </li>
            <li><a href="#"><i class="fa-solid fa-triangle-exclamation"></i> <span data-key="nav_complaint">Complaint</span></a></li>
           <li>
                <a href="javascript:void(0)" onclick="openFeedbackModal()">
                    <i class="fa-solid fa-comments"></i> 
                    <span data-key="nav_feedback">Feedback</span>
                </a>
            </li>
            <li><a href="#"><i class="fa-solid fa-hand-holding-hand"></i> <span data-key="nav_request">Requests</span></a></li>
            <li><a href="#"><i class="fa-solid fa-user-clock"></i> <span data-key="nav_visitor">Visitor Gate</span></a></li>
        </ul>
        
        <div style="margin-top: auto; padding: 20px;">
            <button onclick="handleLogout()" style="width:100%; padding:10px; background:rgba(255,255,255,0.1); border:none; color:white; cursor:pointer; border-radius:5px;">
                <i class="fa-solid fa-sign-out-alt"></i> <span data-key="logout">Logout</span>
            </button>
        </div>
    </aside>

    <div class="dashboard-container">
        <div class="main-content">
            
            <nav class="top-header">
                <div class="header-left">
                    <div class="menu-toggle" onclick="toggleSidebar()">
                        <i class="fa-solid fa-bars"></i>
                    </div>
                    <div class="welcome-text">
                        <h2 id="welcomeMsg"><span data-key="welcome">Welcome</span>, User</h2>
                        <span id="dateDisplay">Loading date...</span>
                    </div>
                </div>

                <div class="header-right">
                    <select class="lang-select" onchange="changeLanguage(this.value)">
                        <option value="en">English</option>
                        <option value="mr">मराठी</option>
                        <option value="hi">हिंदी</option>
                    </select>

                    <button class="icon-btn" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                        <i class="fa-solid fa-moon"></i>
                    </button>
                    
                    <button class="icon-btn" title="Settings">
                        <i class="fa-solid fa-gear"></i>
                    </button>

                    <div class="user-profile" onclick="toggleProfileMenu()">
                        <div class="user-avatar" id="userInitials">U</div>
                        <span style="font-weight:bold; font-size:0.9rem;" id="navUserName">User</span>
                    </div>
                </div>
            </nav>

            <div class="content-wrapper">
                
                <div class="stats-grid">
                    <div class="stat-card card-1">
                        <div class="stat-info">
                            <h3 id="countMembers">1,240</h3>
                            <p data-key="stat_members">Total Members</p>
                        </div>
                        <i class="fa-solid fa-users stat-icon"></i>
                    </div>
                    <div class="stat-card card-2">
                        <div class="stat-info">
                            <h3 id="countActive">85</h3>
                            <p data-key="stat_active">Today Active</p>
                        </div>
                        <i class="fa-solid fa-user-check stat-icon"></i>
                    </div>
                    <div class="stat-card card-3">
                        <div class="stat-info">
                            <h3 id="countHouses">450</h3>
                            <p data-key="stat_house">House Count</p>
                        </div>
                        <i class="fa-solid fa-house-chimney stat-icon"></i>
                    </div>
                    <div class="stat-card card-4">
                        <div class="stat-info">
                            <h3 id="countRequests">12</h3>
                            <p data-key="stat_request">Requests Arised</p>
                        </div>
                        <i class="fa-solid fa-bell stat-icon"></i>
                    </div>
                    <div class="stat-card card-5">
                        <div class="stat-info">
                            <h3 id="countComplaints">3</h3>
                            <p data-key="stat_complaint">Complaint Box</p>
                        </div>
                        <i class="fa-solid fa-box-archive stat-icon"></i>
                    </div>
                    <div class="stat-card card-6">
                        <div class="stat-info">
                            <h3 id="countEnquiry">7</h3>
                            <p data-key="stat_enquiry">Enquiry</p>
                        </div>
                        <i class="fa-solid fa-circle-question stat-icon"></i>
                    </div>
                </div>

                <div class="sections-grid">
                    
                    <div class="left-col">
                        <div class="section-card">
                            <div class="section-header">
                                <h3 data-key="sec_notice">Notice Board</h3>
                                <button class="icon-btn"><i class="fa-solid fa-arrow-right"></i></button>
                            </div>
                            <ul class="notice-list">
                                <li class="notice-item">
                                    <div class="notice-date">27 Jan 2026</div>
                                    <div data-key="notice_1">Annual General Meeting scheduled for next Sunday at Club House.</div>
                                </li>
                                <li class="notice-item">
                                    <div class="notice-date">25 Jan 2026</div>
                                    <div data-key="notice_2">Water tank cleaning in Wing A & B. Water supply will be affected.</div>
                                </li>
                                <li class="notice-item">
                                    <div class="notice-date">20 Jan 2026</div>
                                    <div data-key="notice_3">Republic Day celebration photos are uploaded in Gallery.</div>
                                </li>
                            </ul>
                        </div>

                        <div class="section-card">
                            <div class="section-header">
                                <h3 data-key="sec_gallery">Gallery & Events</h3>
                                <button class="icon-btn"><i class="fa-solid fa-images"></i></button>
                            </div>
                            <div class="gallery-grid">
                                <div style="background:#ddd; height:100px; border-radius:8px;"></div>
                                <div style="background:#ccc; height:100px; border-radius:8px;"></div>
                                <div style="background:#bbb; height:100px; border-radius:8px;"></div>
                                <div style="background:#aaa; height:100px; border-radius:8px;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="right-col">
                        
                        <div class="section-card festival-card">
                            <div class="festival-icon"><i class="fa-solid fa-om"></i></div>
                            <h2 data-key="fest_name">Maha Shivratri</h2>
                            <p data-key="fest_desc">Upcoming festival on 14th Feb. Join us for Puja.</p>
                        </div>

                        <div class="section-card">
                            <div class="section-header">
                                <h3 data-key="sec_location">Society Location</h3>
                            </div>
                            <div class="map-container">
                                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d121059.0471115669!2d73.79258476251214!3d18.524598599502376!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bc2bf2e67461101%3A0x828d43bf9d9ee343!2sPune%2C%20Maharashtra!5e0!3m2!1sen!2sin!4v1700000000000!5m2!1sen!2sin" allowfullscreen="" loading="lazy"></iframe>
                            </div>
                        </div>

                    </div>
                </div>

            </div> </div>
    </div>

  <script>
/* =====================================================
   GLOBAL CONFIG
===================================================== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyX-EHFyM2_rTj6jl--WmDp6Xk_xGbbRCLWxjfyl9hFyrUhZPa_H7ZBYTaMDVSUYmjG/exec";

/* =====================================================
   PAGE LOAD & AUTH
===================================================== */
window.onload = () => {
    if (localStorage.getItem("is_logged_in") !== "true") {
        window.location.href = "index.html";
        return;
    }
    updateUserUI();
    restoreTheme();
    updateDate("en");
    loadDashboardStats();
};

/* =====================================================
   USER INFO
===================================================== */
function updateUserUI() {
    const name = localStorage.getItem("user_name") || "Member";
    const first = name.split(" ")[0];

    document.getElementById("welcomeMsg").innerHTML =
        `<span data-key="welcome">Welcome</span>, ${name}`;

    document.getElementById("navUserName").innerText = first;
    document.getElementById("userInitials").innerText = first[0].toUpperCase();
}

/* =====================================================
   DATE
===================================================== */
function updateDate(lang) {
    const locale = lang === "mr" ? "mr-IN" : lang === "hi" ? "hi-IN" : "en-IN";
    document.getElementById("dateDisplay").innerText =
        new Date().toLocaleDateString(locale, {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric"
        });
}

/* =====================================================
   THEME
===================================================== */
function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem(
        "theme",
        document.body.classList.contains("dark-mode") ? "dark" : "light"
    );
}

function restoreTheme() {
    if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark-mode");
    }
}

/* =====================================================
   SIDEBAR
===================================================== */
function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("active");
    document.getElementById("sidebarOverlay").classList.toggle("active");
}

/* =====================================================
   LOGOUT
===================================================== */
function handleLogout() {
    if (confirm("Are you sure you want to logout?")) {
        localStorage.clear();
        window.location.href = "index.html";
    }
}

/* =====================================================
   DASHBOARD STATS
===================================================== */
function loadDashboardStats() {
    const stats = JSON.parse(localStorage.getItem("dash_stats")) || {};

    const map = {
        countMembers: stats.members || 0,
        countActive: stats.active || 0,
        countComplaints: stats.complaints || 0,
        countEnquiry: stats.enquiries || 0,
        countRequests: stats.requests || 0
    };

    Object.keys(map).forEach(id => animateCount(id, map[id]));
}

function animateCount(id, end) {
    const el = document.getElementById(id);
    if (!el) return;

    let start = 0;
    const duration = 800;
    const step = Math.ceil(end / 50);

    const timer = setInterval(() => {
        start += step;
        if (start >= end) {
            el.innerText = end;
            clearInterval(timer);
        } else {
            el.innerText = start;
        }
    }, duration / 50);
}

/* =====================================================
   ENQUIRY MODAL
===================================================== */
let enquiryPayload = {};

function openEnquiryModal() {
    document.getElementById("enquiryModal").classList.remove("hidden");
}

function closeEnquiryModal() {
    document.getElementById("enquiryModal").classList.add("hidden");
}

function previewImage(input) {
    const preview = document.getElementById("imgPreview");
    preview.innerHTML = "";
    if (!input.files.length) return;

    const reader = new FileReader();
    reader.onload = e => {
        preview.innerHTML = `<img src="${e.target.result}" style="width:100px;border-radius:6px;">`;
    };
    reader.readAsDataURL(input.files[0]);
}

function handleEnquiryReview(e) {
    e.preventDefault();

    enquiryPayload = {
        action: "submitEnquiry",
        name: enqName.value,
        email: enqEmail.value,
        phone: enqPhone.value,
        type: enqType.value,
        text: enqText.value
    };

    document.getElementById("reviewContent").innerHTML = `
        <p><b>Type:</b> ${enquiryPayload.type}</p>
        <p><b>Phone:</b> ${enquiryPayload.phone}</p>
        <p><b>Details:</b> ${enquiryPayload.text}</p>
    `;

    document.getElementById("stylishReview").classList.remove("hidden");
}

async function finalSubmitEnquiry() {
    const btn = document.querySelector(".btn-confirm");
    btn.disabled = true;
    btn.innerText = "Sending...";

    try {
        const res = await fetch(SCRIPT_URL, {
            method: "POST",
            body: new URLSearchParams(enquiryPayload)
        });

        if (!res.ok) throw new Error("Server error");

        const data = await res.json();
        if (data.result === "success") {
            alert("Enquiry sent successfully!");
            location.reload();
        } else {
            throw new Error("Submission failed");
        }
    } catch (err) {
        alert("Server unreachable or script error.");
        console.error(err);
    } finally {
        btn.disabled = false;
        btn.innerText = "Confirm & Send";
    }
}

/* =====================================================
   FEEDBACK MODAL
===================================================== */
function openFeedbackModal() {
    fbName.value = localStorage.getItem("user_name") || "Guest";
    fbID.value = localStorage.getItem("user_id") || "N/A";
    document.getElementById("feedbackModal").classList.remove("hidden");
}

function closeFeedbackModal() {
    document.getElementById("feedbackModal").classList.add("hidden");
}

async function submitFeedback(e) {
    e.preventDefault();

    const rating = document.querySelector("input[name='rate']:checked");
    if (!rating) {
        alert("Please select a rating.");
        return;
    }

    const payload = {
        action: "submitFeedback",
        name: fbName.value,
        loginId: fbID.value,
        phone: fbPhone.value,
        email: fbEmail.value,
        feedback: fbText.value,
        rating: rating.value
    };

    const btn = e.target.querySelector("button");
    btn.disabled = true;
    btn.innerText = "Submitting...";

    try {
        const res = await fetch(SCRIPT_URL, {
            method: "POST",
            body: new URLSearchParams(payload)
        });

        if (!res.ok) throw new Error("Network error");

        const data = await res.json();
        if (data.result === "success") {
            alert("Feedback submitted!");
            location.reload();
        } else {
            throw new Error("Failed");
        }
    } catch (err) {
        alert("Feedback submission failed.");
        console.error(err);
    } finally {
        btn.disabled = false;
        btn.innerText = "Submit Feedback";
    }
}
</script>

<div id="enquiryModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fa-solid fa-pen-to-square"></i> New Enquiry</h3>
            <button class="close-modal" onclick="closeEnquiryModal()">&times;</button>
        </div>
        <form id="enquiryForm" onsubmit="handleEnquiryReview(event)">
            <div class="form-grid">
                <input type="text" id="enqName" placeholder="Full Name" required>
                <input type="email" id="enqEmail" placeholder="Email ID" required>
                <input type="tel" id="enqPhone" placeholder="10-Digit Phone No" pattern="[0-9]{10}" required>
                <select id="enqType" required>
                    <option value="">Enquiry Type</option>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Parking">Parking Space</option>
                    <option value="Billing">Billing/Maintenance Dues</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <textarea id="enqText" maxlength="250" placeholder="Type your enquiry here (Max 250 chars)..." required></textarea>
            
            <div class="upload-section">
                <label for="enqImg"><i class="fa-solid fa-image"></i> Add Image (Optional)</label>
                <input type="file" id="enqImg" accept="image/*" onchange="previewImage(this)">
                <div id="imgPreview"></div>
            </div>

            <button type="submit" class="btn-primary-full">Review & Submit</button>
        </form>
    </div>
</div>

<div id="stylishReview" class="stylish-alert-overlay hidden">
    <div class="stylish-alert-card">
        <div class="alert-icon"><i class="fa-solid fa-magnifying-glass-chart"></i></div>
        <h3>Review Details</h3>
        <div id="reviewContent" class="review-body"></div>
        <div class="alert-actions">
            <button class="btn-cancel" onclick="hideReview()">Edit</button>
            <button class="btn-confirm" onclick="finalSubmitEnquiry()">Confirm & Send</button>
        </div>
    </div>
</div>
<div id="feedbackModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fa-solid fa-star"></i> Society Feedback</h3>
            <button class="close-modal" onclick="closeFeedbackModal()">&times;</button>
        </div>
        <form id="feedbackForm" onsubmit="submitFeedback(event)">
            <div class="rating-container">
                <div class="star-widget">
                    <input type="radio" name="rate" id="rate-5" value="5"><label for="rate-5" class="fas fa-star"></label>
                    <input type="radio" name="rate" id="rate-4" value="4"><label for="rate-4" class="fas fa-star"></label>
                    <input type="radio" name="rate" id="rate-3" value="3"><label for="rate-3" class="fas fa-star"></label>
                    <input type="radio" name="rate" id="rate-2" value="2"><label for="rate-2" class="fas fa-star"></label>
                    <input type="radio" name="rate" id="rate-1" value="1"><label for="rate-1" class="fas fa-star"></label>
                </div>
            </div>

            <div class="form-grid">
                <input type="text" id="fbName" placeholder="Name" readonly>
                <input type="text" id="fbID" placeholder="Login ID" readonly>
                <input type="tel" id="fbPhone" placeholder="Phone No" required>
                <input type="email" id="fbEmail" placeholder="Email ID (Optional)">
            </div>
            <textarea id="fbText" maxlength="1500" placeholder="Your Feedback (Max 300 words)..." required></textarea>
            
            <button type="submit" class="btn-primary-full">Submit Feedback</button>
        </form>
        <div class="section-card">
    <div class="section-header">
        <h3>Recent Feedback</h3>
    </div>
    <div class="table-responsive">
        <table style="width:100%; border-collapse: collapse;">
            <thead>
                <tr style="text-align:left; border-bottom: 2px solid var(--primary);">
                    <th style="padding:10px;">Sr.</th>
                    <th style="padding:10px;">Name</th>
                </tr>
            </thead>
            <tbody id="feedbackTableBody">
                <tr><td style="padding:10px;">1</td><td style="padding:10px;">Rahul Sharma</td></tr>
            </tbody>
        </table>
    </div>
</div>
    </div>
</div>
</body>
</html>